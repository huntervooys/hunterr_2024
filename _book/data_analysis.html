<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>hunterr_2024 - 5&nbsp; Introductory Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./0R_references.html" rel="next">
<link href="./04_visualization.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "/"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introductory Data Analysis</span></h1>
        </a>     
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">hunterr_2024</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/huntervooys/hunterr_2024" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div id="quarto-search" class="quarto-navigation-tool px-1" title="Search"></div>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">R and Friends</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_lore.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Lore</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_r_and_friends.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R and Friends</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_r_101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R 101</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introductory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Statistics</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0R_references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0A_resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Getting Help</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">on this page</h2>
   
  <ul>
  <li><a href="#the-data" id="toc-the-data" class="nav-link active" data-scroll-target="#the-data"><span class="header-section-number">5.1</span> The Data</a></li>
  <li><a href="#tidying-the-starbucks-data" id="toc-tidying-the-starbucks-data" class="nav-link" data-scroll-target="#tidying-the-starbucks-data"><span class="header-section-number">5.2</span> Tidying the Starbucks Data</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/huntervooys/hunterr_2024/edit/main/data_analysis.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/huntervooys/hunterr_2024/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introductory Data Analysis</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="the-data" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="the-data"><span class="header-section-number">5.1</span> The Data</h2>
<p>We are going to start our data analysis adventure with <a href="https://www.kaggle.com/datasets/ihormuliar/starbucks-customer-data?resource=download">Starbucks customer data</a> that is available from Kaggle. This data was collected by Starbucks to analyze the spending behavior of Starbucks customers in response to various promotions. This data has also been used for <a href="https://www.kaggle.com/code/chrisbohanon/starbucks-customer-segmentation">market segmentation</a> analysis (albeit in python). There are three tables included in this dataset.</p>
<p>In R there are a few ways to preview a dataset. If you just type out its name, as I’ve done for portfolio, then the entire dataframe will display. This is acceptable for portfolio, which has 10 observations (one observation for each promotional deal), but much less so for transcript, which has over 300,000 observations.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>portfolio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["reward"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["channels"],"name":[2],"type":["chr"],"align":["left"]},{"label":["difficulty"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["duration"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["offer_type"],"name":[5],"type":["chr"],"align":["left"]},{"label":["id"],"name":[6],"type":["chr"],"align":["left"]}],"data":[{"1":"10","2":"['email', 'mobile', 'social']","3":"10","4":"7","5":"bogo","6":"ae264e3637204a6fb9bb56bc8210ddfd"},{"1":"10","2":"['web', 'email', 'mobile', 'social']","3":"10","4":"5","5":"bogo","6":"4d5c57ea9a6940dd891ad53e9dbe8da0"},{"1":"0","2":"['web', 'email', 'mobile']","3":"0","4":"4","5":"informational","6":"3f207df678b143eea3cee63160fa8bed"},{"1":"5","2":"['web', 'email', 'mobile']","3":"5","4":"7","5":"bogo","6":"9b98b8c7a33c4b65b9aebfe6a799e6d9"},{"1":"5","2":"['web', 'email']","3":"20","4":"10","5":"discount","6":"0b1e1539f2cc45b7b9fa7c272da2e1d7"},{"1":"3","2":"['web', 'email', 'mobile', 'social']","3":"7","4":"7","5":"discount","6":"2298d6c36e964ae4a3e7e9706d1fb8c2"},{"1":"2","2":"['web', 'email', 'mobile', 'social']","3":"10","4":"10","5":"discount","6":"fafdcd668e3743c1bb461111dcafc2a4"},{"1":"0","2":"['email', 'mobile', 'social']","3":"0","4":"3","5":"informational","6":"5a8bc65990b245e5a138643cd4eb9837"},{"1":"5","2":"['web', 'email', 'mobile', 'social']","3":"5","4":"5","5":"bogo","6":"f19421c1d4aa40978ebb69ca19b0e20d"},{"1":"2","2":"['web', 'email', 'mobile']","3":"10","4":"7","5":"discount","6":"2906b810c7d4411798c6938adc9daaa5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Each column in this table is a variable. If we want to get a closer look at the variables in the data we can use the <code>glimpse</code> function, like so:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">glimpse</span>(portfolio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 10
Columns: 6
$ reward     &lt;dbl&gt; 10, 10, 0, 5, 5, 3, 2, 0, 5, 2
$ channels   &lt;chr&gt; "['email', 'mobile', 'social']", "['web', 'email', 'mobile'…
$ difficulty &lt;dbl&gt; 10, 10, 0, 5, 20, 7, 10, 0, 5, 10
$ duration   &lt;dbl&gt; 7, 5, 4, 7, 10, 7, 10, 3, 5, 7
$ offer_type &lt;chr&gt; "bogo", "bogo", "informational", "bogo", "discount", "disco…
$ id         &lt;chr&gt; "ae264e3637204a6fb9bb56bc8210ddfd", "4d5c57ea9a6940dd891ad5…</code></pre>
</div>
</div>
<p>The <code>glimpse</code> function lists the dimensions of the data at the top (which are also available through the <code>dim</code> function (which is one of the OG functions from S). Below that is a list of the names of the 6 columns, which type of data is stored in each (with <code>&lt;chr&gt;</code> corresponding to character or text data, and <code>&lt;dbl&gt;</code> corresponding to floating point numerical data). <code>glimpse</code> also shows the first values in each of the columns. Overall, <code>glimpse</code> and <code>head</code> (as well as <code>tail</code>, if that suits your fancy) are probably the first functions you should use when starting a data analysis project. It is important to orient yourself to the data early.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">dim</span>(portfolio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10  6</code></pre>
</div>
</div>
<p>So let’s do that. The <code>reward</code> column represents the monetary value of the promotion (0$ for informational communications like the one in row 3, and a value equal to the <code>difficulty</code> in a bogo sale, like those in rows one and two). <code>difficulty</code>, in turn, is the amount of money the customer has to spend to receive the reward. Both <code>difficulty</code> and <code>reward</code> are measured in dollars. <code>channels</code> is a list of strings that describe how the offer was communicated to the customers, and <code>offer_type</code> is either “bogo,” “informational,” or “discount.” <code>duration</code> refers to the duration of the offer, but no unit is specified. I suspect it is measured in days. Finally, the <code>id</code> is an alphanumeric code that we will use to merge our three datasets</p>
<p>To view just the first few rows of the data, you can use the <code>head</code> function. The <code>tail</code> function would show the last few rows of the <code>profile</code> table.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">head</span>(profile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["gender"],"name":[1],"type":["chr"],"align":["left"]},{"label":["age"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["id"],"name":[3],"type":["chr"],"align":["left"]},{"label":["became_member_on"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["income"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"118","3":"68be06ca386d4c31939f3a4f0e3dd783","4":"20170212","5":"NA"},{"1":"F","2":"55","3":"0610b486422d4921ae7d2bf64640c50b","4":"20170715","5":"112000"},{"1":"NA","2":"118","3":"38fe809add3b4fcf9315a9694bb96ff5","4":"20180712","5":"NA"},{"1":"F","2":"75","3":"78afa995795e4d85b5d9ceeca43f5fef","4":"20170509","5":"100000"},{"1":"NA","2":"118","3":"a03223e636434f42ac4c3df47e8bac43","4":"20170804","5":"NA"},{"1":"M","2":"68","3":"e2127556f4f64592b11af22de27a7932","4":"20180426","5":"70000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">glimpse</span>(profile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17,000
Columns: 5
$ gender           &lt;chr&gt; NA, "F", NA, "F", NA, "M", NA, NA, "M", NA, NA, NA, "…
$ age              &lt;dbl&gt; 118, 55, 118, 75, 118, 68, 118, 118, 65, 118, 118, 11…
$ id               &lt;chr&gt; "68be06ca386d4c31939f3a4f0e3dd783", "0610b486422d4921…
$ became_member_on &lt;dbl&gt; 20170212, 20170715, 20180712, 20170509, 20170804, 201…
$ income           &lt;dbl&gt; NA, 112000, NA, 100000, NA, 70000, NA, NA, 53000, NA,…</code></pre>
</div>
</div>
<p>As we can see, the profile data describes Starbucks customers according to their <code>gender</code>, their <code>age</code>, their <code>income</code>, and the date they joined the rewards program (<code>became_member_on</code>). The clients also have an <code>id</code>, which is another alphanumeric code that we will use to merge our three datasets.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">head</span>(transcript)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["person"],"name":[1],"type":["chr"],"align":["left"]},{"label":["event"],"name":[2],"type":["chr"],"align":["left"]},{"label":["value"],"name":[3],"type":["chr"],"align":["left"]},{"label":["time"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"78afa995795e4d85b5d9ceeca43f5fef","2":"offer received","3":"{'offer id': '9b98b8c7a33c4b65b9aebfe6a799e6d9'}","4":"0"},{"1":"a03223e636434f42ac4c3df47e8bac43","2":"offer received","3":"{'offer id': '0b1e1539f2cc45b7b9fa7c272da2e1d7'}","4":"0"},{"1":"e2127556f4f64592b11af22de27a7932","2":"offer received","3":"{'offer id': '2906b810c7d4411798c6938adc9daaa5'}","4":"0"},{"1":"8ec6ce2a7e7949b1bf142def7d0e0586","2":"offer received","3":"{'offer id': 'fafdcd668e3743c1bb461111dcafc2a4'}","4":"0"},{"1":"68617ca6246f4fbc85e91a2a49552598","2":"offer received","3":"{'offer id': '4d5c57ea9a6940dd891ad53e9dbe8da0'}","4":"0"},{"1":"389bc3fa690240e798340f5a15918d5c","2":"offer received","3":"{'offer id': 'f19421c1d4aa40978ebb69ca19b0e20d'}","4":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">glimpse</span>(transcript)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 306,534
Columns: 4
$ person &lt;chr&gt; "78afa995795e4d85b5d9ceeca43f5fef", "a03223e636434f42ac4c3df47e…
$ event  &lt;chr&gt; "offer received", "offer received", "offer received", "offer re…
$ value  &lt;chr&gt; "{'offer id': '9b98b8c7a33c4b65b9aebfe6a799e6d9'}", "{'offer id…
$ time   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
</div>
<p>The transcript table has only four variables in it: the <code>person</code> (the alphanumeric code corresponding to the client); the <code>value</code> (a string containing the alphanumeric code for the offer), the <code>event</code> (either “offer received,” “offer viewed,” “transaction,” or “offer completed”), and the <code>time</code> which is the time - in hours - with the day starting at <span class="math inline">\(\text{time} = 0\)</span>.</p>
<p>I would like to momentarily draw your attention to the <code>value</code> column in the transcript table. This column is a dictionary, which is a data structure that is not easily interpretable by R. This column contiains the <code>offer_id</code> that we will use to merge the transcript table with the portfolio table, as well as the <code>amount</code> of money spent by the customer. We will need to extract this information from the <code>value</code> column before we can merge the transcript table with the portfolio table.</p>
<p>That’s tricky as shit in R, which does not really have dictionaries. Instead, I have gone done all of the data merging for you in Python, according to the instructions on this <a href="https://www.kaggle.com/code/chrisbohanon/starbucks-customer-segmentation">Kaggle notebook</a>. In any case, here is the new, merged data file:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(data_path, <span class="st">"starbucks_data.csv"</span>)) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>...<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
Rows: 306534 Columns: 20
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(8): gender, customer_id, person, event, offer_id_or_amount, values, of... dbl
(12): ...1, age, became_member_on, income, time, reward, difficulty, dur...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
• `` -&gt; `...1`</code></pre>
</div>
</div>
<p>Traditionally, you would use one of the <code>join</code> functions to merge the three data frames. I used the corresponding python method (the pandas <code>merge</code> method) to join the data which was (for a number of relatively unimportant reasons) much easier than merging the data in R.</p>
<p>In any case, let’s take a look at our final dataset. All of the variables will come from one (or more) of the three datasets above.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># to save memory (i.e., allow R to run faster), we can remove the three original datasets</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="fu">rm</span>(portfolio, profile, transcript)</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="fu">glimpse</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 306,534
Columns: 19
$ gender             &lt;chr&gt; "M", "M", "M", "M", "M", "M", "M", "M", "M", "M", "…
$ age                &lt;dbl&gt; 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33, 33,…
$ customer_id        &lt;chr&gt; "0009655768c64bdeb2e877511632db8f", "0009655768c64b…
$ became_member_on   &lt;dbl&gt; 20170421, 20170421, 20170421, 20170421, 20170421, 2…
$ income             &lt;dbl&gt; 72000, 72000, 72000, 72000, 72000, 72000, 72000, 72…
$ person             &lt;chr&gt; "0009655768c64bdeb2e877511632db8f", "0009655768c64b…
$ event              &lt;chr&gt; "transaction", "transaction", "transaction", "offer…
$ time               &lt;dbl&gt; 696, 414, 690, 168, 408, 540, 528, 528, 192, 660, 4…
$ offer_id_or_amount &lt;chr&gt; "amount", "amount", "amount", "offer_id", "offer_id…
$ values             &lt;chr&gt; "18.41", "8.57", "28.16", "5a8bc65990b245e5a138643c…
$ offer_if_or_amount &lt;chr&gt; "amount", "amount", "amount", "offer_id", "offer_id…
$ reward             &lt;dbl&gt; NA, NA, NA, 0, 5, 2, NA, 2, 0, NA, 5, 5, NA, 2, 2, …
$ difficulty         &lt;dbl&gt; NA, NA, NA, 0, 5, 10, NA, 10, 0, NA, 5, 5, NA, 10, …
$ duration           &lt;dbl&gt; NA, NA, NA, 3, 5, 10, NA, 10, 3, NA, 5, 5, NA, 7, 1…
$ offer_type         &lt;chr&gt; NA, NA, NA, "informational", "bogo", "discount", NA…
$ channel_web        &lt;dbl&gt; NA, NA, NA, 1, 1, 1, NA, 1, 1, NA, 1, 1, NA, 1, 1, …
$ channel_email      &lt;dbl&gt; NA, NA, NA, 0, 0, 0, NA, 0, 0, NA, 0, 0, NA, 0, 0, …
$ channel_mobile     &lt;dbl&gt; NA, NA, NA, 1, 1, 1, NA, 1, 1, NA, 1, 1, NA, 1, 1, …
$ channel_social     &lt;dbl&gt; NA, NA, NA, 1, 1, 1, NA, 1, 1, NA, 1, 1, NA, 0, 1, …</code></pre>
</div>
</div>
</section>
<section id="tidying-the-starbucks-data" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="tidying-the-starbucks-data"><span class="header-section-number">5.2</span> Tidying the Starbucks Data</h2>
<p>Tidy data has the following characteristics:</p>
<ul>
<li><p>every column represents one variable</p></li>
<li><p>every row represents one observation</p></li>
<li><p>every cell has one value</p></li>
</ul>
<p>In truth, the process of “tidying” this data began in python. I would like to draw your attention to six new columns in the data. Firstly, there are two new columns called <code>offer_id_or_amount</code> and <code>offer_if_or_amount</code>. These two columns are probably the result of a typo, but before we get rid of one, it’s best practice to see that they are identical. We’ll make a simple hypothesis: <code>offer_id_or_amount</code> is the same as <code>offer_if_or_amount</code> for every observation. This hypothesis entails that there are 0 rows in the data where these two columns are <strong>not</strong> equal.</p>
<p>In R (and many other programming languages), there is a difference between <code>=</code> and <code>==</code>. <code>=</code> (a single equals sign) is an assignment operator; it takes what is on its right side and stores it in the computers memory using the name on its left. Two equals signs (<code>==</code>), by contrast, is a comparison operator. When you use <code>==</code>, you are asking R to tell you whether the thing on the right is the same as the thing on the left, resulting in R returning a value of either <code>TRUE</code> or <code>FALSE</code>. We can use <code>!=</code> to ask R whether the thing on the right is <strong>not</strong> the same as the thing on the left.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">filter</span>(offer_id_or_amount <span class="sc">!=</span> offer_if_or_amount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["gender"],"name":[1],"type":["chr"],"align":["left"]},{"label":["age"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["customer_id"],"name":[3],"type":["chr"],"align":["left"]},{"label":["became_member_on"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["income"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["person"],"name":[6],"type":["chr"],"align":["left"]},{"label":["event"],"name":[7],"type":["chr"],"align":["left"]},{"label":["time"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["offer_id_or_amount"],"name":[9],"type":["chr"],"align":["left"]},{"label":["values"],"name":[10],"type":["chr"],"align":["left"]},{"label":["offer_if_or_amount"],"name":[11],"type":["chr"],"align":["left"]},{"label":["reward"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["difficulty"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["duration"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["offer_type"],"name":[15],"type":["chr"],"align":["left"]},{"label":["channel_web"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["channel_email"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["channel_mobile"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["channel_social"],"name":[19],"type":["dbl"],"align":["right"]}],"data":[],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>As you can see, I used the <code>filter</code> function (and the <code>!=</code> operator) to filter out all of the observations where the two columns are <strong>not</strong> equal. Because there are 0 rows in the result, I conclude that the two columns are identical. We can use the <code>select</code> function and a minus sign (<code>-</code>) to tell R that we would like to preserve all of the columns in the data except for <code>offer_if_or_amount</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># we need to reassign the name 'data' to the version with the errant column removed</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">select</span>(<span class="sc">-</span>offer_if_or_amount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Ok. Now that that’s out of the way, there are additionally four new columns: the last four. Previously, in <code>portfolio</code>, the <code>channel</code> variable stored lists of values (in a form like <code>[web, mobile, social]</code>). This is not tidy because it breaks the third rule, allowing multiple values to reside within a single cell. I did something called <strong>dummy coding</strong> the variables. Take a look, and I think you’ll get the idea. The individual channels are split into separate columns, which are filled with 0’s and 1’s (and NA values, more on that later) to indicate the use or lack of use of that channel. It communicates the same information, except with one value per cell instead of a list of values.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"channel"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["channel_web"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["channel_email"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["channel_mobile"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["channel_social"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0","3":"1","4":"0"},{"1":"1","2":"0","3":"1","4":"1"},{"1":"1","2":"0","3":"1","4":"1"},{"1":"1","2":"0","3":"1","4":"1"},{"1":"1","2":"0","3":"1","4":"1"},{"1":"1","2":"0","3":"1","4":"1"},{"1":"1","2":"0","3":"1","4":"0"},{"1":"1","2":"0","3":"1","4":"1"},{"1":"1","2":"0","3":"1","4":"1"},{"1":"1","2":"0","3":"1","4":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>R is pretty good about catching most normally formatted NA values during the input process. It will call blank cells NA, as well as any cell with “NA” or “N/A” in it.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show code for this result</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># compute number of NA values in each column</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="fu">summarise_all</span>(<span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["gender"],"name":[1],"type":["int"],"align":["right"]},{"label":["age"],"name":[2],"type":["int"],"align":["right"]},{"label":["customer_id"],"name":[3],"type":["int"],"align":["right"]},{"label":["became_member_on"],"name":[4],"type":["int"],"align":["right"]},{"label":["income"],"name":[5],"type":["int"],"align":["right"]},{"label":["person"],"name":[6],"type":["int"],"align":["right"]},{"label":["event"],"name":[7],"type":["int"],"align":["right"]},{"label":["time"],"name":[8],"type":["int"],"align":["right"]},{"label":["offer_id_or_amount"],"name":[9],"type":["int"],"align":["right"]},{"label":["values"],"name":[10],"type":["int"],"align":["right"]},{"label":["reward"],"name":[11],"type":["int"],"align":["right"]},{"label":["difficulty"],"name":[12],"type":["int"],"align":["right"]},{"label":["duration"],"name":[13],"type":["int"],"align":["right"]},{"label":["offer_type"],"name":[14],"type":["int"],"align":["right"]},{"label":["channel_web"],"name":[15],"type":["int"],"align":["right"]},{"label":["channel_email"],"name":[16],"type":["int"],"align":["right"]},{"label":["channel_mobile"],"name":[17],"type":["int"],"align":["right"]},{"label":["channel_social"],"name":[18],"type":["int"],"align":["right"]}],"data":[{"1":"33772","2":"0","3":"0","4":"0","5":"33772","6":"0","7":"0","8":"0","9":"0","10":"0","11":"138953","12":"138953","13":"138953","14":"138953","15":"138953","16":"138953","17":"138953","18":"138953"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04_visualization.html" class="pagination-link" aria-label="Visualization">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualization</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./0R_references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb20" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu"># Introductory Data Analysis</span></span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="in">```{r setup, echo=TRUE, include=FALSE}</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="in"># renv::install("tidyverse")</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="in">library(tidyverse)</span></span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="in">data_path &lt;- path.expand("data/starbucks_customer_data")</span></span>
<span id="cb20-8"><a href="#cb20-8"></a></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="in"># Load the data</span></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="in">portfolio &lt;- read_csv(file.path(data_path, "portfolio.csv")) |&gt; select(-...1)</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="in">profile &lt;- read_csv(file.path(data_path, "profile.csv")) |&gt; select(-...1)</span></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="in">transcript &lt;- read_csv(file.path(data_path, "transcript.csv")) |&gt; select(-...1)</span></span>
<span id="cb20-13"><a href="#cb20-13"></a></span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="in">```</span></span>
<span id="cb20-15"><a href="#cb20-15"></a></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="fu">## The Data</span></span>
<span id="cb20-17"><a href="#cb20-17"></a></span>
<span id="cb20-18"><a href="#cb20-18"></a>We are going to start our data analysis adventure with <span class="co">[</span><span class="ot">Starbucks customer data</span><span class="co">](https://www.kaggle.com/datasets/ihormuliar/starbucks-customer-data?resource=download)</span> that is available from Kaggle. This data was collected by Starbucks to analyze the spending behavior of Starbucks customers in response to various promotions. This data has also been used for <span class="co">[</span><span class="ot">market segmentation</span><span class="co">](https://www.kaggle.com/code/chrisbohanon/starbucks-customer-segmentation)</span> analysis (albeit in python). There are three tables included in this dataset.</span>
<span id="cb20-19"><a href="#cb20-19"></a></span>
<span id="cb20-20"><a href="#cb20-20"></a>In R there are a few ways to preview a dataset. If you just type out its name, as I've done for portfolio, then the entire dataframe will display. This is acceptable for portfolio, which has 10 observations (one observation for each promotional deal), but much less so for transcript, which has over 300,000 observations.</span>
<span id="cb20-21"><a href="#cb20-21"></a></span>
<span id="cb20-22"><a href="#cb20-22"></a><span class="in">```{r portfolio, echo=TRUE}</span></span>
<span id="cb20-23"><a href="#cb20-23"></a><span class="in">portfolio</span></span>
<span id="cb20-24"><a href="#cb20-24"></a><span class="in">```</span></span>
<span id="cb20-25"><a href="#cb20-25"></a></span>
<span id="cb20-26"><a href="#cb20-26"></a>Each column in this table is a variable. If we want to get a closer look at the variables in the data we can use the <span class="in">`glimpse`</span> function, like so:</span>
<span id="cb20-27"><a href="#cb20-27"></a></span>
<span id="cb20-30"><a href="#cb20-30"></a><span class="in">```{r}</span></span>
<span id="cb20-31"><a href="#cb20-31"></a><span class="fu">glimpse</span>(portfolio)</span>
<span id="cb20-32"><a href="#cb20-32"></a><span class="in">```</span></span>
<span id="cb20-33"><a href="#cb20-33"></a></span>
<span id="cb20-34"><a href="#cb20-34"></a>The <span class="in">`glimpse`</span> function lists the dimensions of the data at the top (which are also available through the <span class="in">`dim`</span> function (which is one of the OG functions from S). Below that is a list of the names of the 6 columns, which type of data is stored in each (with <span class="in">`&lt;chr&gt;`</span> corresponding to character or text data, and <span class="in">`&lt;dbl&gt;`</span> corresponding to floating point numerical data). <span class="in">`glimpse`</span> also shows the first values in each of the columns. Overall, <span class="in">`glimpse`</span> and <span class="in">`head`</span> (as well as <span class="in">`tail`</span>, if that suits your fancy) are probably the first functions you should use when starting a data analysis project. It is important to orient yourself to the data early.</span>
<span id="cb20-35"><a href="#cb20-35"></a></span>
<span id="cb20-38"><a href="#cb20-38"></a><span class="in">```{r}</span></span>
<span id="cb20-39"><a href="#cb20-39"></a><span class="fu">dim</span>(portfolio)</span>
<span id="cb20-40"><a href="#cb20-40"></a><span class="in">```</span></span>
<span id="cb20-41"><a href="#cb20-41"></a></span>
<span id="cb20-42"><a href="#cb20-42"></a>So let's do that. The <span class="in">`reward`</span> column represents the monetary value of the promotion (0\$ for informational communications like the one in row 3, and a value equal to the <span class="in">`difficulty`</span> in a bogo sale, like those in rows one and two). <span class="in">`difficulty`</span>, in turn, is the amount of money the customer has to spend to receive the reward. Both <span class="in">`difficulty`</span> and <span class="in">`reward`</span> are measured in dollars. <span class="in">`channels`</span> is a list of strings that describe how the offer was communicated to the customers, and <span class="in">`offer_type`</span> is either "bogo," "informational," or "discount." <span class="in">`duration`</span> refers to the duration of the offer, but no unit is specified. I suspect it is measured in days. Finally, the <span class="in">`id`</span> is an alphanumeric code that we will use to merge our three datasets</span>
<span id="cb20-43"><a href="#cb20-43"></a></span>
<span id="cb20-44"><a href="#cb20-44"></a>To view just the first few rows of the data, you can use the <span class="in">`head`</span> function. The <span class="in">`tail`</span> function would show the last few rows of the <span class="in">`profile`</span> table.</span>
<span id="cb20-45"><a href="#cb20-45"></a></span>
<span id="cb20-46"><a href="#cb20-46"></a><span class="in">```{r profile, echo=TRUE}</span></span>
<span id="cb20-47"><a href="#cb20-47"></a><span class="in">head(profile)</span></span>
<span id="cb20-48"><a href="#cb20-48"></a><span class="in">glimpse(profile)</span></span>
<span id="cb20-49"><a href="#cb20-49"></a><span class="in">```</span></span>
<span id="cb20-50"><a href="#cb20-50"></a></span>
<span id="cb20-51"><a href="#cb20-51"></a>As we can see, the profile data describes Starbucks customers according to their <span class="in">`gender`</span>, their <span class="in">`age`</span>, their <span class="in">`income`</span>, and the date they joined the rewards program (<span class="in">`became_member_on`</span>). The clients also have an <span class="in">`id`</span>, which is another alphanumeric code that we will use to merge our three datasets.</span>
<span id="cb20-52"><a href="#cb20-52"></a></span>
<span id="cb20-53"><a href="#cb20-53"></a><span class="in">```{r transcript, echo=TRUE}</span></span>
<span id="cb20-54"><a href="#cb20-54"></a><span class="in">head(transcript)</span></span>
<span id="cb20-55"><a href="#cb20-55"></a><span class="in">glimpse(transcript)</span></span>
<span id="cb20-56"><a href="#cb20-56"></a><span class="in">```</span></span>
<span id="cb20-57"><a href="#cb20-57"></a></span>
<span id="cb20-58"><a href="#cb20-58"></a>The transcript table has only four variables in it: the <span class="in">`person`</span> (the alphanumeric code corresponding to the client); the <span class="in">`value`</span> (a string containing the alphanumeric code for the offer), the <span class="in">`event`</span> (either "offer received," "offer viewed," "transaction," or "offer completed"), and the <span class="in">`time`</span> which is the time - in hours - with the day starting at $\text{time} = 0$.</span>
<span id="cb20-59"><a href="#cb20-59"></a></span>
<span id="cb20-60"><a href="#cb20-60"></a>I would like to momentarily draw your attention to the <span class="in">`value`</span> column in the transcript table. This column is a dictionary, which is a data structure that is not easily interpretable by R. This column contiains the <span class="in">`offer_id`</span> that we will use to merge the transcript table with the portfolio table, as well as the <span class="in">`amount`</span> of money spent by the customer. We will need to extract this information from the <span class="in">`value`</span> column before we can merge the transcript table with the portfolio table.</span>
<span id="cb20-61"><a href="#cb20-61"></a></span>
<span id="cb20-62"><a href="#cb20-62"></a>That's tricky as shit in R, which does not really have dictionaries. Instead, I have gone done all of the data merging for you in Python, according to the instructions on this <span class="co">[</span><span class="ot">Kaggle notebook</span><span class="co">](https://www.kaggle.com/code/chrisbohanon/starbucks-customer-segmentation)</span>. In any case, here is the new, merged data file:</span>
<span id="cb20-63"><a href="#cb20-63"></a></span>
<span id="cb20-66"><a href="#cb20-66"></a><span class="in">```{r}</span></span>
<span id="cb20-67"><a href="#cb20-67"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(data_path, <span class="st">"starbucks_data.csv"</span>)) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>...<span class="dv">1</span>)</span>
<span id="cb20-68"><a href="#cb20-68"></a><span class="in">```</span></span>
<span id="cb20-69"><a href="#cb20-69"></a></span>
<span id="cb20-70"><a href="#cb20-70"></a>Traditionally, you would use one of the <span class="in">`join`</span> functions to merge the three data frames. I used the corresponding python method (the pandas <span class="in">`merge`</span> method) to join the data which was (for a number of relatively unimportant reasons) much easier than merging the data in R.</span>
<span id="cb20-71"><a href="#cb20-71"></a></span>
<span id="cb20-72"><a href="#cb20-72"></a>In any case, let's take a look at our final dataset. All of the variables will come from one (or more) of the three datasets above.</span>
<span id="cb20-73"><a href="#cb20-73"></a></span>
<span id="cb20-76"><a href="#cb20-76"></a><span class="in">```{r}</span></span>
<span id="cb20-77"><a href="#cb20-77"></a><span class="co"># to save memory (i.e., allow R to run faster), we can remove the three original datasets</span></span>
<span id="cb20-78"><a href="#cb20-78"></a><span class="fu">rm</span>(portfolio, profile, transcript)</span>
<span id="cb20-79"><a href="#cb20-79"></a></span>
<span id="cb20-80"><a href="#cb20-80"></a><span class="fu">glimpse</span>(data)</span>
<span id="cb20-81"><a href="#cb20-81"></a><span class="in">```</span></span>
<span id="cb20-82"><a href="#cb20-82"></a></span>
<span id="cb20-83"><a href="#cb20-83"></a><span class="fu">## Tidying the Starbucks Data</span></span>
<span id="cb20-84"><a href="#cb20-84"></a></span>
<span id="cb20-85"><a href="#cb20-85"></a>Tidy data has the following characteristics:</span>
<span id="cb20-86"><a href="#cb20-86"></a></span>
<span id="cb20-87"><a href="#cb20-87"></a><span class="ss">-   </span>every column represents one variable</span>
<span id="cb20-88"><a href="#cb20-88"></a></span>
<span id="cb20-89"><a href="#cb20-89"></a><span class="ss">-   </span>every row represents one observation</span>
<span id="cb20-90"><a href="#cb20-90"></a></span>
<span id="cb20-91"><a href="#cb20-91"></a><span class="ss">-   </span>every cell has one value</span>
<span id="cb20-92"><a href="#cb20-92"></a></span>
<span id="cb20-93"><a href="#cb20-93"></a>In truth, the process of "tidying" this data began in python. I would like to draw your attention to six new columns in the data. Firstly, there are two new columns called <span class="in">`offer_id_or_amount`</span> and <span class="in">`offer_if_or_amount`</span>. These two columns are probably the result of a typo, but before we get rid of one, it's best practice to see that they are identical. We'll make a simple hypothesis: <span class="in">`offer_id_or_amount`</span> is the same as <span class="in">`offer_if_or_amount`</span> for every observation. This hypothesis entails that there are 0 rows in the data where these two columns are **not** equal.</span>
<span id="cb20-94"><a href="#cb20-94"></a></span>
<span id="cb20-95"><a href="#cb20-95"></a>In R (and many other programming languages), there is a difference between <span class="in">`=`</span> and <span class="in">`==`</span>. <span class="in">`=`</span> (a single equals sign) is an assignment operator; it takes what is on its right side and stores it in the computers memory using the name on its left. Two equals signs (<span class="in">`==`</span>), by contrast, is a comparison operator. When you use <span class="in">`==`</span>, you are asking R to tell you whether the thing on the right is the same as the thing on the left, resulting in R returning a value of either <span class="in">`TRUE`</span> or <span class="in">`FALSE`</span>. We can use <span class="in">`!=`</span> to ask R whether the thing on the right is **not** the same as the thing on the left.</span>
<span id="cb20-96"><a href="#cb20-96"></a></span>
<span id="cb20-99"><a href="#cb20-99"></a><span class="in">```{r}</span></span>
<span id="cb20-100"><a href="#cb20-100"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb20-101"><a href="#cb20-101"></a>  <span class="fu">filter</span>(offer_id_or_amount <span class="sc">!=</span> offer_if_or_amount)</span>
<span id="cb20-102"><a href="#cb20-102"></a><span class="in">```</span></span>
<span id="cb20-103"><a href="#cb20-103"></a></span>
<span id="cb20-104"><a href="#cb20-104"></a>As you can see, I used the <span class="in">`filter`</span> function (and the <span class="in">`!=`</span> operator) to filter out all of the observations where the two columns are **not** equal. Because there are 0 rows in the result, I conclude that the two columns are identical. We can use the <span class="in">`select`</span> function and a minus sign (<span class="in">`-`</span>) to tell R that we would like to preserve all of the columns in the data except for <span class="in">`offer_if_or_amount`</span>.</span>
<span id="cb20-105"><a href="#cb20-105"></a></span>
<span id="cb20-108"><a href="#cb20-108"></a><span class="in">```{r}</span></span>
<span id="cb20-109"><a href="#cb20-109"></a><span class="co"># we need to reassign the name 'data' to the version with the errant column removed</span></span>
<span id="cb20-110"><a href="#cb20-110"></a>data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> </span>
<span id="cb20-111"><a href="#cb20-111"></a>  <span class="fu">select</span>(<span class="sc">-</span>offer_if_or_amount)</span>
<span id="cb20-112"><a href="#cb20-112"></a><span class="in">```</span></span>
<span id="cb20-113"><a href="#cb20-113"></a></span>
<span id="cb20-114"><a href="#cb20-114"></a>Ok. Now that that's out of the way, there are additionally four new columns: the last four. Previously, in <span class="in">`portfolio`</span>, the <span class="in">`channel`</span> variable stored lists of values (in a form like <span class="in">`[web, mobile, social]`</span>). This is not tidy because it breaks the third rule, allowing multiple values to reside within a single cell. I did something called **dummy coding** the variables. Take a look, and I think you'll get the idea. The individual channels are split into separate columns, which are filled with 0's and 1's (and NA values, more on that later) to indicate the use or lack of use of that channel. It communicates the same information, except with one value per cell instead of a list of values.</span>
<span id="cb20-115"><a href="#cb20-115"></a></span>
<span id="cb20-118"><a href="#cb20-118"></a><span class="in">```{r}</span></span>
<span id="cb20-119"><a href="#cb20-119"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb20-120"><a href="#cb20-120"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"channel"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb20-121"><a href="#cb20-121"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb20-122"><a href="#cb20-122"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb20-123"><a href="#cb20-123"></a><span class="in">```</span></span>
<span id="cb20-124"><a href="#cb20-124"></a></span>
<span id="cb20-125"><a href="#cb20-125"></a>R is pretty good about catching most normally formatted NA values during the input process. It will call blank cells NA, as well as any cell with "NA" or "N/A" in it.</span>
<span id="cb20-126"><a href="#cb20-126"></a></span>
<span id="cb20-129"><a href="#cb20-129"></a><span class="in">```{r}</span></span>
<span id="cb20-130"><a href="#cb20-130"></a><span class="co"># compute number of NA values in each column</span></span>
<span id="cb20-131"><a href="#cb20-131"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb20-132"><a href="#cb20-132"></a>  <span class="fu">summarise_all</span>(<span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.)))</span>
<span id="cb20-133"><a href="#cb20-133"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/huntervooys/hunterr_2024/edit/main/data_analysis.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/huntervooys/hunterr_2024/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>